<!DOCTYPE html>
<html>
<head>
    <title>Test Product Access</title>
</head>
<body>
    <h1>Test Product Access</h1>
    <button onclick="testProductAccess()">Test Product Access</button>
    <div id="result"></div>

    <script>
        async function testProductAccess() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Testing...';
            
            try {
                // Test Premium product
                console.log('Testing Premium product...');
                const premiumResponse = await fetch('/products/8482650226838.js');
                console.log('Premium response status:', premiumResponse.status);
                
                if (premiumResponse.ok) {
                    const premiumProduct = await premiumResponse.json();
                    console.log('Premium product:', premiumProduct);
                    resultDiv.innerHTML += `<p>✅ Premium product accessible. Variant ID: ${premiumProduct.variants[0].id}</p>`;
                } else {
                    resultDiv.innerHTML += `<p>❌ Premium product not accessible: ${premiumResponse.status}</p>`;
                }
                
                // Test Pro product
                console.log('Testing Pro product...');
                const proResponse = await fetch('/products/8482650554518.js');
                console.log('Pro response status:', proResponse.status);
                
                if (proResponse.ok) {
                    const proProduct = await proResponse.json();
                    console.log('Pro product:', proProduct);
                    resultDiv.innerHTML += `<p>✅ Pro product accessible. Variant ID: ${proProduct.variants[0].id}</p>`;
                } else {
                    resultDiv.innerHTML += `<p>❌ Pro product not accessible: ${proResponse.status}</p>`;
                }
                
                // Test Collections API
                console.log('Testing Collections API...');
                const collectionsResponse = await fetch('/collections/subscriptions/products.json');
                console.log('Collections response status:', collectionsResponse.status);
                
                if (collectionsResponse.ok) {
                    const collectionsData = await collectionsResponse.json();
                    console.log('Collections data:', collectionsData);
                    
                    // Find Premium product
                    const premiumProduct = collectionsData.products.find(p => p.id.toString() === '8482650226838');
                    if (premiumProduct) {
                        resultDiv.innerHTML += `<p>✅ Premium product found in collections. Variant ID: ${premiumProduct.variants[0].id}</p>`;
                        
                        // Check for selling plans
                        if (premiumProduct.selling_plan_groups && premiumProduct.selling_plan_groups.length > 0) {
                            const sellingPlanGroup = premiumProduct.selling_plan_groups[0];
                            if (sellingPlanGroup.selling_plans && sellingPlanGroup.selling_plans.length > 0) {
                                const sellingPlanId = sellingPlanGroup.selling_plans[0].id;
                                resultDiv.innerHTML += `<p>✅ Premium selling plan ID: ${sellingPlanId}</p>`;
                            } else {
                                resultDiv.innerHTML += `<p>⚠️ Premium product has selling plan groups but no selling plans</p>`;
                            }
                        } else {
                            resultDiv.innerHTML += `<p>⚠️ Premium product has no selling plan groups</p>`;
                        }
                    } else {
                        resultDiv.innerHTML += `<p>❌ Premium product not found in collections</p>`;
                    }
                    
                    // Find Pro product
                    const proProduct = collectionsData.products.find(p => p.id.toString() === '8482650554518');
                    if (proProduct) {
                        resultDiv.innerHTML += `<p>✅ Pro product found in collections. Variant ID: ${proProduct.variants[0].id}</p>`;
                        
                        // Check for selling plans
                        if (proProduct.selling_plan_groups && proProduct.selling_plan_groups.length > 0) {
                            const sellingPlanGroup = proProduct.selling_plan_groups[0];
                            if (sellingPlanGroup.selling_plans && sellingPlanGroup.selling_plans.length > 0) {
                                const sellingPlanId = sellingPlanGroup.selling_plans[0].id;
                                resultDiv.innerHTML += `<p>✅ Pro selling plan ID: ${sellingPlanId}</p>`;
                            } else {
                                resultDiv.innerHTML += `<p>⚠️ Pro product has selling plan groups but no selling plans</p>`;
                            }
                        } else {
                            resultDiv.innerHTML += `<p>⚠️ Pro product has no selling plan groups</p>`;
                        }
                    } else {
                        resultDiv.innerHTML += `<p>❌ Pro product not found in collections</p>`;
                    }
                } else {
                    resultDiv.innerHTML += `<p>❌ Collections API not accessible: ${collectionsResponse.status}</p>`;
                }
                
            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML += `<p>❌ Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
